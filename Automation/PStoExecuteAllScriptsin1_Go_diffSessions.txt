$server = "SQLserver1"             # SQL Server instance name
$database = "StackOverflow2013"    # Database name
$scriptFolderPath = "F:\Script"    # Script folder path

# SQL Server credentials (using SQL authentication)
$username = "DomainAdmin"          # Username
$password = "<REDACTED_PASSWORD>"         # Password

# Convert the password to a SecureString
$securePassword = ConvertTo-SecureString -String $password -AsPlainText -Force

# Getting all .txt files from the script folder
$scriptFiles = Get-ChildItem -Path $scriptFolderPath -Filter "*.txt"

# Starting a background job for each script file
foreach ($scriptFile in $scriptFiles) {
    Start-Job -ScriptBlock {
        param ($scriptPath, $server, $database, $username, $password)

        $connectionString = "Server=$server;Database=$database;User ID=$username;Password=$password;"  # SQL authentication

        $scriptContent = Get-Content $scriptPath -Raw
        if (-not [string]::IsNullOrWhiteSpace($scriptContent)) {
            $connection = New-Object System.Data.SqlClient.SqlConnection($connectionString)
            $command = New-Object System.Data.SqlClient.SqlCommand($scriptContent, $connection)
            $command.CommandTimeout = 600  # Increase command timeout to 120 seconds (2 minutes)
            $connection.Open()
            $command.ExecuteNonQuery()
            $connection.Close()
        }
    } -ArgumentList $scriptFile.FullName, $server, $database, $username, $password
}

# Wait for all jobs to complete
Get-Job | Wait-Job

# Output the results of each job
Get-Job | Receive-Job

# Clean up the jobs
Get-Job | Remove-Job